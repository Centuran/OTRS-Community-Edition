!function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/search/searchcursor",["../../lib/codemirror"],b):b(CodeMirror)}(function(b){function A(f,a){var c;c=f.flags;for(var g=c=null!=c?c:(f.ignoreCase?"i":"")+(f.global?"g":"")+(f.multiline?"m":""),d=0;d<a.length;d++)-1==g.indexOf(a.charAt(d))&&(g+=a.charAt(d));return c==g?f:new RegExp(f.source,g)}function B(f,a,c){a=A(a,"g");var g=c.line,d=c.ch;for(c=f.lastLine();g<=
c;g++,d=0)if(a.lastIndex=d,d=f.getLine(g),d=a.exec(d))return{from:l(g,d.index),to:l(g,d.index+d[0].length),match:d}}function p(f,a,c){if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(a.source))return B(f,a,c);a=A(a,"gm");for(var g,d=1,e=c.line,t=f.lastLine();e<=t;){for(var x=0;x<d&&!(e>t);x++){var b=f.getLine(e++);g=null==g?b:g+"\n"+b}d*=2;a.lastIndex=c.ch;if(x=a.exec(g))return a=g.slice(0,x.index).split("\n"),f=x[0].split("\n"),c=c.line+a.length-1,a=a[a.length-1].length,{from:l(c,a),to:l(c+f.length-1,1==f.length?
a+f[0].length:f[f.length-1].length),match:x}}}function m(f,a,c){for(var g,d=0;d<=f.length;){a.lastIndex=d;d=a.exec(f);if(!d)break;var e=d.index+d[0].length;if(e>f.length-c)break;(!g||e>g.index+g[0].length)&&(g=d);d=d.index+1}return g}function h(f,a,c){a=A(a,"g");var g=c.line,d=c.ch;for(c=f.firstLine();g>=c;g--,d=-1){var e=f.getLine(g);if(d=m(e,a,0>d?0:e.length-d))return{from:l(g,d.index),to:l(g,d.index+d[0].length),match:d}}}function q(f,a,c){if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(a.source))return h(f,
a,c);a=A(a,"gm");var g,d=1,e=f.getLine(c.line).length-c.ch;c=c.line;for(var t=f.firstLine();c>=t;){for(var b=0;b<d&&c>=t;b++){var v=f.getLine(c--);g=null==g?v:v+"\n"+g}d*=2;if(b=m(g,a,e))return a=g.slice(0,b.index).split("\n"),f=b[0].split("\n"),c+=a.length,a=a[a.length-1].length,{from:l(c,a),to:l(c+f.length-1,1==f.length?a+f[0].length:f[f.length-1].length),match:b}}}function k(f,a,c,g){if(f.length==a.length)return c;var d=0;for(a=c+Math.max(0,f.length-a.length);;){if(d==a)return d;var e=d+a>>1,t=
g(f.slice(0,e)).length;if(t==c)return e;t>c?a=e:d=e+1}}function r(f,a,c,g){if(!a.length)return null;g=g?n:w;a=g(a).split(/\r|\n\r?/);var d=c.line;c=c.ch;var e=f.lastLine()+1-a.length;a:for(;d<=e;d++,c=0){var t=f.getLine(d).slice(c),b=g(t);if(1==a.length){var v=b.indexOf(a[0]);if(-1==v)continue a;k(t,b,v,g);return{from:l(d,k(t,b,v,g)+c),to:l(d,k(t,b,v+a[0].length,g)+c)}}v=b.length-a[0].length;if(b.slice(v)==a[0]){for(var u=1;u<a.length-1;u++)if(g(f.getLine(d+u))!=a[u])continue a;var u=f.getLine(d+
a.length-1),h=g(u),p=a[a.length-1];if(h.slice(0,p.length)==p)return{from:l(d,k(t,b,v,g)+c),to:l(d+a.length-1,k(u,h,p.length,g))}}}}function y(f,a,c,b){if(!a.length)return null;b=b?n:w;a=b(a).split(/\r|\n\r?/);var d=c.line,e=c.ch,t=f.firstLine()-1+a.length;a:for(;d>=t;d--,e=-1){var x=f.getLine(d);-1<e&&(x=x.slice(0,e));e=b(x);if(1==a.length){c=e.lastIndexOf(a[0]);if(-1==c)continue a;return{from:l(d,k(x,e,c,b)),to:l(d,k(x,e,c+a[0].length,b))}}var v=a[a.length-1];if(e.slice(0,v.length)==v){var u=1;for(c=
d-a.length+1;u<a.length-1;u++)if(b(f.getLine(c+u))!=a[u])continue a;c=f.getLine(d+1-a.length);u=b(c);if(u.slice(u.length-a[0].length)==a[0])return{from:l(d+1-a.length,k(c,u,c.length-a[0].length,b)),to:l(d,k(x,e,v.length,b))}}}}function z(b,a,c,g){this.atOccurrence=!1;this.doc=b;c=c?b.clipPos(c):l(0,0);this.pos={from:c,to:c};var d;"object"==typeof g?d=g.caseFold:(d=g,g=null);"string"==typeof a?(null==d&&(d=!1),this.matches=function(e,c){return(e?y:r)(b,a,c,d)}):(a=A(a,"gm"),g&&!1===g.multiline?this.matches=
function(e,c){return(e?h:B)(b,a,c)}:this.matches=function(e,c){return(e?q:p)(b,a,c)})}var n,w,l=b.Pos;String.prototype.normalize?(n=function(b){return b.normalize("NFD").toLowerCase()},w=function(b){return b.normalize("NFD")}):(n=function(b){return b.toLowerCase()},w=function(b){return b});z.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(f){for(var a=this.matches(f,this.doc.clipPos(f?this.pos.from:this.pos.to));a&&0==b.cmpPos(a.from,
a.to);)f?a.from.ch?a.from=l(a.from.line,a.from.ch-1):a=a.from.line==this.doc.firstLine()?null:this.matches(f,this.doc.clipPos(l(a.from.line-1))):a.to.ch<this.doc.getLine(a.to.line).length?a.to=l(a.to.line,a.to.ch+1):a=a.to.line==this.doc.lastLine()?null:this.matches(f,l(a.to.line+1,0));if(a)return this.pos=a,this.atOccurrence=!0,this.pos.match||!0;f=l(f?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:f,to:f},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},
to:function(){if(this.atOccurrence)return this.pos.to},replace:function(f,a){if(this.atOccurrence){var c=b.splitLines(f);this.doc.replaceRange(c,this.pos.from,this.pos.to,a);this.pos.to=l(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0))}}};b.defineExtension("getSearchCursor",function(b,a,c){return new z(this.doc,b,a,c)});b.defineDocExtension("getSearchCursor",function(b,a,c){return new z(this,b,a,c)});b.defineExtension("selectMatches",function(f,a){for(var c=[],
g=this.getSearchCursor(f,this.getCursor("from"),a);g.findNext()&&!(0<b.cmpPos(g.to(),this.getCursor("to")));)c.push({anchor:g.from(),head:g.to()});c.length&&this.setSelections(c,0)})});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/dialog/dialog",["../../lib/codemirror"],b):b(CodeMirror)})(function(b){function A(p,m,h){var q;p=p.getWrapperElement();return q=p.appendChild(document.createElement("div")),q.className=h?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof m?q.innerHTML=m:q.appendChild(m),b.addClass(p,"dialog-opened"),
q}function B(b,m){b.state.currentNotificationClose&&b.state.currentNotificationClose();b.state.currentNotificationClose=m}b.defineExtension("openDialog",function(p,m,h){function q(w){"string"==typeof w?n.value=w:y||(y=!0,b.rmClass(r.parentNode,"dialog-opened"),r.parentNode.removeChild(r),z.focus(),h.onClose&&h.onClose(r))}h||(h={});B(this,null);var k,r=A(this,p,h.bottom),y=!1,z=this,n=r.getElementsByTagName("input")[0];return n?(n.focus(),h.value&&(n.value=h.value,!1!==h.selectValueOnOpen&&n.select()),
h.onInput&&b.on(n,"input",function(b){h.onInput(b,n.value,q)}),h.onKeyUp&&b.on(n,"keyup",function(b){h.onKeyUp(b,n.value,q)}),b.on(n,"keydown",function(k){h&&h.onKeyDown&&h.onKeyDown(k,n.value,q)||((27==k.keyCode||!1!==h.closeOnEnter&&13==k.keyCode)&&(n.blur(),b.e_stop(k),q()),13==k.keyCode&&m(n.value,k))}),!1!==h.closeOnBlur&&b.on(r,"focusout",function(b){null!==b.relatedTarget&&q()})):(k=r.getElementsByTagName("button")[0])&&(b.on(k,"click",function(){q();z.focus()}),!1!==h.closeOnBlur&&b.on(k,
"blur",q),k.focus()),q});b.defineExtension("openConfirm",function(p,m,h){function q(){r||(r=!0,b.rmClass(k.parentNode,"dialog-opened"),k.parentNode.removeChild(k),y.focus())}B(this,null);var k=A(this,p,h&&h.bottom);p=k.getElementsByTagName("button");var r=!1,y=this,z=1;p[0].focus();for(h=0;h<p.length;++h){var n=p[h];!function(h){b.on(n,"click",function(k){b.e_preventDefault(k);q();h&&h(y)})}(m[h]);b.on(n,"blur",function(){--z;setTimeout(function(){0>=z&&q()},200)});b.on(n,"focus",function(){++z})}});
b.defineExtension("openNotification",function(p,m){function h(){r||(r=!0,clearTimeout(q),b.rmClass(k.parentNode,"dialog-opened"),k.parentNode.removeChild(k))}B(this,h);var q,k=A(this,p,m&&m.bottom),r=!1,y=m&&void 0!==m.duration?m.duration:5E3;return b.on(k,"click",function(k){b.e_preventDefault(k);h()}),y&&(q=setTimeout(h,y)),h})});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define("addon/search/search.js",["../../lib/codemirror","./searchcursor","../dialog/dialog"],b):b(CodeMirror)})(function(b){function A(e,a){return"string"==typeof e?e=new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),a?"gi":"g"):e.global||(e=new RegExp(e.source,e.ignoreCase?"gi":"g")),{token:function(a){e.lastIndex=
a.pos;var b=e.exec(a.string);if(b&&b.index==a.pos)return a.pos+=b[0].length||1,"searching";b?a.pos=b.index:a.skipToEnd()}}}function B(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function p(e){return e.state.search||(e.state.search=new B)}function m(e){return"string"==typeof e&&e==e.toLowerCase()}function h(e,a,b){return e.getSearchCursor(a,b,{caseFold:m(a),multiline:!0})}function q(e,a,b,c,d){e.openDialog(a,c,{value:b,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){f(e)},
onKeyDown:d,bottom:e.options.search.bottom})}function k(e,a,b,c,d){e.openDialog?e.openDialog(a,d,{value:c,selectValueOnOpen:!0,bottom:e.options.search.bottom}):d(prompt(b,c))}function r(e,a,b,c){e.openConfirm?e.openConfirm(a,c):confirm(b)&&c[0]()}function y(e){return e.replace(/\\([nrt\\])/g,function(e,a){return"n"==a?"\n":"r"==a?"\r":"t"==a?"\t":"\\"==a?"\\":e})}function z(e){var a=e.match(/^\/(.*)\/([a-z]*)$/);if(a)try{e=new RegExp(a[1],-1==a[2].indexOf("i")?"":"i")}catch(b){}else e=y(e);return("string"==
typeof e?""==e:e.test(""))&&(e=/x^/),e}function n(e,a,b){a.queryText=b;a.query=z(b);e.removeOverlay(a.overlay,m(a.query));a.overlay=A(a.query,m(a.query));e.addOverlay(a.overlay);e.showMatchesOnScrollbar&&(a.annotate&&(a.annotate.clear(),a.annotate=null),a.annotate=e.showMatchesOnScrollbar(a.query,m(a.query)))}function w(e,c,d,f){var g=p(e);if(g.query)return l(e,c);var h=e.getSelection()||g.lastQuery;if(h instanceof RegExp&&"x^"==h.source&&(h=null),d&&e.openDialog){var m=null,r=function(a,c){b.e_stop(c);
a&&(a!=g.queryText&&(n(e,g,a),g.posFrom=g.posTo=e.getCursor()),m&&(m.style.opacity=1),l(e,c.shiftKey,function(a,b){var c;3>b.line&&document.querySelector&&(c=e.display.wrapper.querySelector(".CodeMirror-dialog"))&&c.getBoundingClientRect().bottom-4>e.cursorCoords(b,"window").top&&((m=c).style.opacity=.4)}))};q(e,a(e),h,r,function(a,c){var d=b.keyName(a),g=e.getOption("extraKeys"),d=g&&g[d]||b.keyMap[e.getOption("keyMap")][d];"findNext"==d||"findPrev"==d||"findPersistentNext"==d||"findPersistentPrev"==
d?(b.e_stop(a),n(e,p(e),c),e.execCommand(d)):"find"!=d&&"findPersistent"!=d||(b.e_stop(a),r(c,a))});f&&h&&(n(e,g,h),l(e,c))}else k(e,a(e),"Search for:",h,function(a){a&&!g.query&&e.operation(function(){n(e,g,a);g.posFrom=g.posTo=e.getCursor();l(e,c)})})}function l(a,c,d){a.operation(function(){var g=p(a),f=h(a,g.query,c?g.posFrom:g.posTo);(f.find(c)||(f=h(a,g.query,c?b.Pos(a.lastLine()):b.Pos(a.firstLine(),0)),f.find(c)))&&(a.setSelection(f.from(),f.to()),a.scrollIntoView({from:f.from(),to:f.to()},
20),g.posFrom=f.from(),g.posTo=f.to(),d&&d(f.from(),f.to()))})}function f(a){a.operation(function(){var b=p(a);(b.lastQuery=b.query)&&(b.query=b.queryText=null,a.removeOverlay(b.overlay),b.annotate&&(b.annotate.clear(),b.annotate=null))})}function a(a){return'\x3cspan class\x3d"CodeMirror-search-label"\x3e'+a.phrase("Search:")+'\x3c/span\x3e \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e'+
a.phrase("(Use /re/ syntax for regexp search)")+"\x3c/span\x3e"}function c(a){return'\x3cspan class\x3d"CodeMirror-search-label"\x3e'+a.phrase("Replace?")+"\x3c/span\x3e \x3cbutton\x3e"+a.phrase("Yes")+"\x3c/button\x3e \x3cbutton\x3e"+a.phrase("No")+"\x3c/button\x3e \x3cbutton\x3e"+a.phrase("All")+"\x3c/button\x3e \x3cbutton\x3e"+a.phrase("Stop")+"\x3c/button\x3e "}function g(a,b,c){a.operation(function(){for(var d=h(a,b);d.findNext();)if("string"!=typeof b){var g=a.getRange(d.from(),d.to()).match(b);
d.replace(c.replace(/\$(\d)/g,function(a,b){return g[b]}))}else d.replace(c)})}function d(a,b){if(!a.getOption("readOnly")){var d=a.getSelection()||p(a).lastQuery,l='\x3cspan class\x3d"CodeMirror-search-label"\x3e'+(b?a.phrase("Replace all:"):a.phrase("Replace:"))+"\x3c/span\x3e";k(a,l+(' \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e'+a.phrase("(Use /re/ syntax for regexp search)")+"\x3c/span\x3e"),
l,d,function(d){d&&(d=z(d),k(a,'\x3cspan class\x3d"CodeMirror-search-label"\x3e'+a.phrase("With:")+'\x3c/span\x3e \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e',a.phrase("Replace with:"),"",function(k){if(k=y(k),b)g(a,d,k);else{f(a);var l=h(a,d,a.getCursor("from")),m=function(){var b,f=l.from();!(b=l.findNext())&&(l=h(a,d),!(b=l.findNext())||f&&l.from().line==f.line&&l.from().ch==f.ch)||(a.setSelection(l.from(),l.to()),a.scrollIntoView({from:l.from(),to:l.to()}),
r(a,c(a),a.phrase("Replace?"),[function(){n(b)},m,function(){g(a,d,k)}]))},n=function(a){l.replace("string"==typeof d?k:k.replace(/\$(\d)/g,function(b,c){return a[c]}));m()};m()}}))})}}b.defineOption("search",{bottom:!1});b.commands.find=function(a){f(a);w(a)};b.commands.findPersistent=function(a){f(a);w(a,!1,!0)};b.commands.findPersistentNext=function(a){w(a,!1,!0,!0)};b.commands.findPersistentPrev=function(a){w(a,!0,!0,!0)};b.commands.findNext=w;b.commands.findPrev=function(a){w(a,!0)};b.commands.clearSearch=
f;b.commands.replace=d;b.commands.replaceAll=function(a){d(a,!0)}});(function(b){"function"==typeof b.define&&b.define("addonSearch",["addon/search/search.js"],function(){})})(this);